{% extends "base.html" %}
{% block title %}Online Eğitimler | HR LMS{% endblock %}

{% block content %}
<style>
  .hero { padding:8px 0 18px; }
  .hero h1 { margin:8px 0 6px; font-size:28px; }
  .muted { color: var(--muted); }
  .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap:12px; margin-top:10px; }
  .card { background:#fff; border:1px solid var(--bd); border-radius:14px; padding:10px; transition:box-shadow .15s ease, transform .05s ease; }
  .card:hover { box-shadow:0 6px 20px rgba(0,0,0,.07); transform: translateY(-1px); }
  .thumb { width:100%; aspect-ratio: 16/9; object-fit: cover; border-radius:10px; background:#f2f4f7; }
  .title { margin:8px 0 2px; font-size:16px; font-weight:600; }
  .title a { color:inherit; text-decoration:none; }
  .title a:hover { text-decoration:underline; }
  .sub { margin:0 0 6px; font-size:12px; color:#475569; } /* toplam süre satırı */
  .meta { font-size:12px; color:#475569; display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
  .bar { height:6px; background:#e5e7eb; border-radius:999px; overflow:hidden; margin-top:8px; }
  .bar > span { display:block; height:100%; width:0; background:#10b981; }
  .actions { margin-top:8px; display:flex; gap:8px; }
  .empty{ padding:18px; text-align:center; color:var(--muted); grid-column:1/-1; }
  .thumb-link{ display:block; }
</style>

<script>
  // sn -> "X saat Y dakika Z saniye"
  function fmtHMS(sec){
    sec = Math.max(0, Math.floor(Number(sec) || 0));
    const h = Math.floor(sec/3600);
    const m = Math.floor((sec%3600)/60);
    const s = sec%60;
    const parts = [];
    if (h) parts.push(h + " saat");
    if (m) parts.push(m + " dakika");
    if (s || parts.length===0) parts.push(s + " saniye");
    return parts.join(" ");
  }
</script>

<div class="hero">
  <h1>Online Eğitimler</h1>
  <div class="muted">Video tabanlı eğitimler; kaldığınız yerden devam edin. %90 izleyince tamamlanır.</div>
</div>

<div class="grid">
  {% for v in videos %}
    <article class="card">

      {% if request.user.is_authenticated %}
        <a class="thumb-link" href="{% url 'online-watch' v.pk %}">
      {% else %}
        <a class="thumb-link" href="{% url 'login' %}?next={% url 'online-watch' v.pk %}">
      {% endif %}
          {% if v.thumbnail %}
            <img class="thumb" src="{{ v.thumbnail.url }}" alt="{{ v.title|default:v.training.title }}">
          {% else %}
            <div class="thumb"></div>
          {% endif %}
        </a>

      <div class="title">
        {% if request.user.is_authenticated %}
          <a href="{% url 'online-watch' v.pk %}">{{ v.title|default:v.training.title }}</a>
        {% else %}
          <a href="{% url 'login' %}?next={% url 'online-watch' v.pk %}">{{ v.title|default:v.training.title }}</a>
        {% endif %}
      </div>

      <!-- TOPLAM VİDEO SÜRESİ: başlığın altında H:M:S -->
      <p class="sub">
        Toplam video süresi:
        <span id="d{{ v.id }}" data-secs="{{ v.duration_seconds|default:0 }}">…</span>
      </p>

      <!-- Alt bilgi satırı: yalnız İlerleme ve İzlenen -->
      <div class="meta">
        <span>İlerleme: %{{ v.progress_percent|default:0 }}</span> •
        <span>İzlenen: <span id="w{{ v.id }}" data-secs="{{ v.progress_seconds|default:0 }}">…</span></span>
      </div>

      <div class="bar" aria-label="İlerleme">
        <span style="width: {{ v.progress_percent|default:0 }}%"></span>
      </div>

      <div class="actions">
        {% if request.user.is_authenticated %}
          <a class="btn" href="{% url 'online-watch' v.pk %}">İzle</a>
        {% else %}
          <a class="btn" href="{% url 'login' %}?next={% url 'online-watch' v.pk %}">Giriş Yap ve İzle</a>
        {% endif %}
      </div>
    </article>
  {% empty %}
    <div class="empty">Şu an görünür online eğitim yok.</div>
  {% endfor %}
</div>

<script>
  // "İzlenen" ve "Toplam" etiketlerini saniyeden H:M:S'e çevir
  document.querySelectorAll('[id^="w"]').forEach(el => {
    const secs = Number(el.dataset.secs || 0);
    el.textContent = fmtHMS(secs);
  });
  document.querySelectorAll('[id^="d"]').forEach(el => {
    const secs = Number(el.dataset.secs || 0);
    el.textContent = fmtHMS(secs);
  });
</script>
{% endblock %}
